# 摄像头头像替换功能

## 功能说明

在角色选择界面，玩家可以使用摄像头捕获自己的头像，替换角色身体上的头部。

## 使用方法

1. **选择角色**: 在角色选择界面，点击角色头像进行选择
   - 玩家1选择后会显示绿色边框和"P1"标签
   - 玩家2选择后会显示蓝色边框和"P2"标签

2. **捕获头像**:
   - 按 **Q** 键：为玩家1捕获摄像头头像
   - 按 **P** 键：为玩家2捕获摄像头头像
   - 首次使用时，浏览器会请求摄像头权限，请允许访问

3. **开始游戏**: 双方选择完成后，按**空格键**开始游戏

## 技术实现

### 新增文件
- `js/CameraManager.js`: 管理摄像头访问和图像捕获

### 修改文件
- `js/CharacterSelectionManager.js`: 添加自定义头像存储
- `js/Character.js`: 添加自定义头像支持和头像位置计算
- `js/CharacterState.js`: 添加头像位置信息存储
- `js/Renderer.js`: 添加自定义头像渲染功能
- `js/GameManager.js`: 集成摄像头管理器和按键处理

### 头像渲染逻辑
1. 从 `characters.json` 中读取每个状态的 `head` 配置
2. 根据角色朝向和位置计算头像的绝对坐标
3. 使用圆形裁剪绘制头像
4. 根据 `direction` 参数旋转头像（90度为正常朝向）

### 头像配置格式
```json
"head": {
  "x": 75,      // 相对于角色图片的x坐标
  "y": 40,      // 相对于角色图片的y坐标
  "w": 50,      // 头像宽度
  "h": 50,      // 头像高度
  "direction": 90  // 头像方向（度数，90为正常朝向）
}
```

## 注意事项

1. 需要浏览器支持 `getUserMedia` API
2. 需要用户授予摄像头访问权限
3. 头像会被裁剪为圆形显示
4. 头像会根据角色状态和朝向自动调整位置和旋转
5. 游戏重置时会清理摄像头资源
